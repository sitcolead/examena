<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Quiz Links from xSiTe</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, open sans,'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
            background: #ffffff;
            min-height: 100vh;
            padding: 40px 20px;
            line-height: 1.6;
            color: #0f172a;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 32px;
            padding: 32px 24px;
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            font-size: 2.25em;
            font-weight: 700;
            color: #0f172a;
            margin-bottom: 8px;
            letter-spacing: -0.025em;
        }
        
        .header p {
            font-size: 1.0625em;
            color: #64748b;
        }
        
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            padding: 28px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }
        
        .bookmarklet-card {
            text-align: center;
            padding: 36px 28px;
            background: linear-gradient(to bottom, #f8fafc, #ffffff);
            border: 2px dashed #cbd5e1;
            position: relative;
        }
        
        .bookmarklet-button {
            display: inline-block;
            background: #006fbf;
            color: white !important;
            text-decoration: none !important;
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.2s;
            cursor: move;
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.3);
        }
        
        .bookmarklet-button:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 6px 12px -1px rgba(59, 130, 246, 0.4);
        }
        
        .instruction {
            color: #64748b;
            font-size: 0.9375em;
            margin-top: -8px;
            font-weight: 500;
        }
        
        .instruction::before {
            content: '↑';
            display: block;
            font-size: 3em;
            margin-bottom: 0px;
            color: #3b82f6;
        }
        
        .section-title {
            font-size: 1.125em;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .step-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .step {
            display: flex;
            gap: 16px;
            padding: 18px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 3px solid #cbd5e1;
            transition: all 0.2s;
        }
        
        .step:hover {
            background: #f1f5f9;
            border-left-color: #2563eb;
            transform: translateX(4px);
        }
        
        .installation-step:hover {
            background: #f8fafc;
            border-left-color: #3b82f6;
            transform: translateX(0);
        }
        
        .step-number {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            background: #0f172a;
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.9375em;
        }
        
        .step-content {
            flex: 1;
        }
        
        .step-title {
            font-size: 0.9375em;
            font-weight: 600;
            color: #0f172a;
            margin-bottom: 6px;
        }
        
        .step-text {
            color: #475569;
            font-size: 0.9375em;
            line-height: 1.6;
        }
        
        .usage-list {
            margin-top: 12px;
            padding-left: 0;
            list-style: none;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .usage-list li {
            padding: 12px 16px;
            background: #f8fafc;
            border-radius: 6px;
            color: #475569;
            font-size: 0.9375em;
            border-left: 3px solid #cbd5e1;
            transition: all 0.2s;
        }
        
        .usage-list li:hover {
            background: #f1f5f9;
            border-left-color: #3b82f6;
        }
        
        .usage-list li::before {
            content: "→";
            color: #3b82f6;
            margin-right: 12px;
            font-weight: 700;
        }
        
        .troubleshooting-item {
            padding: 16px;
            background: #fef2f2;
            border-radius: 8px;
            border-left: 3px solid #ef4444;
            margin-bottom: 12px;
        }
        
        .troubleshooting-item:last-child {
            margin-bottom: 0;
        }
        
        .troubleshooting-item strong {
            color: #991b1b;
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            font-size: 0.9375em;
        }
        
        .troubleshooting-item p {
            color: #7f1d1d;
            font-size: 0.875em;
            line-height: 1.6;
            margin: 0;
        }
        
        .manual-section {
            margin-top: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .browser-item {
            padding: 14px 16px;
            background: #f8fafc;
            border-radius: 8px;
            border-left: 3px solid #64748b;
            transition: all 0.2s;
        }
        
        .browser-item:hover {
            background: #f1f5f9;
            border-left-color: #3b82f6;
        }
        
        .browser-item strong {
            color: #0f172a;
            font-size: 0.9375em;
            font-weight: 600;
        }
        
        .browser-item p {
            color: #64748b;
            font-size: 0.875em;
            margin-top: 4px;
            line-height: 1.5;
        }
        
        .manual-steps {
            margin: 16px 0;
            padding-left: 24px;
            color: #475569;
            font-size: 0.9375em;
        }
        
        .manual-steps li {
            margin-bottom: 8px;
            line-height: 1.6;
        }
        
        .button-primary {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 11px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9375em;
            font-weight: 600;
            transition: all 0.2s;
            font-family: inherit;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }
        
        .button-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }
        
        .button-primary:active {
            transform: translateY(0);
        }
        
        .copy-status {
            color: #16a34a;
            font-size: 0.875em;
            margin-top: 10px;
            font-weight: 500;
            display: inline-block;
            padding: 6px 12px;
            background: #f0fdf4;
            border-radius: 6px;
        }
        
        .alert {
            background: #fffbeb;
            border: 1px solid #fde68a;
            border-left: 3px solid #f59e0b;
            padding: 14px 16px;
            border-radius: 8px;
            font-size: 0.875em;
            color: #92400e;
            margin-top: 16px;
            line-height: 1.6;
        }
        
        .alert strong {
            font-weight: 600;
        }
        
        .keyboard {
            font-family: 'Monaco', 'Courier New', monospace;
            background: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.875em;
            border: 1px solid #cbd5e1;
            color: #0f172a;
            display: inline-block;
            font-weight: 500;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        
        @media (max-width: 640px) {
            body {
                padding: 24px 16px;
            }
            
            .header {
                padding: 24px 20px;
                margin-bottom: 24px;
            }
            
            .header h1 {
                font-size: 1.75em;
            }
            
            .card {
                padding: 20px;
            }
            
            .step {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Get Quiz Links from xSiTe</h1>
            <p>Extract student quiz URLs with two clicks</p>
        </div>
        
        <div class="card bookmarklet-card">
            <div id="bookmarkletContainer"></div>
            <p class="instruction">Drag this button to your bookmarks bar</p>
        </div>

        <div class="card">
            <h2 class="section-title">
                Installation
            </h2>
            <div class="step-group">
                <div class="step installation-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">Show Your Bookmarks or Favorites Bar</div>
                        <div class="step-text">
                            If your bookmarks bar isn't visible, press <span class="keyboard">Ctrl+Shift+B</span> on Windows or <span class="keyboard">Cmd+Shift+B</span> on Mac.
                        </div>
                    </div>
                </div>
                
                <div class="step installation-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Drag the Button</div>
                        <div class="step-text">
                            Click and drag the "Get Quiz Links" button above to your bookmarks bar.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">
                Usage
            </h2>
            <div class="step-text">
                Once installed, follow these steps to extract quiz links:
            </div>
            <ul class="usage-list">
                <li>Navigate to xSiTe course home or content page</li>
                <li>Click the "Get Quiz Links" bookmarklet in your bookmarks bar</li>
                <li>A popup will display all available quiz URLs</li>
                <li>Copy and paste the selected quiz URL into "Exam URL for student" field during Examena setup</li>
            </ul>
        </div>

        <div class="card">
            <h2 class="section-title">
                Troubleshooting
            </h2>
            <div class="troubleshooting-item">
                <strong>Cannot detect course ID</strong>
                <p>Ensure you're on a xSiTe course home or content page with a course number visible in the URL.</p>
            </div>
            <div class="troubleshooting-item">
                <strong>Failed to open new tab</strong>
                <p>Enable pop-ups for xsite.singaporetech.edu.sg in your browser settings.</p>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">
                Manual Installation
            </h2>
            <div class="step-text" style="margin-bottom: 16px;">
                If drag-and-drop doesn't work, you can manually create the bookmark:
            </div>
            
            <div class="manual-section">
                <div class="browser-item">
                    <strong>Chrome</strong>
                    <p>Right-click bookmarks bar → Bookmark Manager → Right-click blank area → Add new bookmark</p>
                </div>
                
                <div class="browser-item">
                    <strong>Edge</strong>
                    <p>Right-click favorites bar → Manage Favorites → Add Favorites...</p>
                </div>
            </div>

            <ol class="manual-steps">
                <li>Set the name to: <strong>Get Quiz Links</strong></li>
                <li>Click the button below to copy the bookmarklet code</li>
                <li>Paste the code into the URL field</li>
                <li>Save the bookmark</li>
            </ol>
            
            <button class="button-primary" onclick="copyBookmarkletCode()">Copy Code</button>
            <div id="copyStatus" class="copy-status" style="display: none;"></div>
            
            <div class="alert">
                <strong>Note:</strong> The code must be pasted exactly as copied into the URL field of the bookmark.
            </div>
        </div>
    </div>

    <script>
        const bookmarkletCode = `javascript:(function(){function e(){const e=window.location.href;if(e.match(/https:\\/\\/xsite\\.singaporetech\\.edu\\.sg\\/d2l\\/le\\/lessons\\/(\\d+)/))return e.match(/https:\\/\\/xsite\\.singaporetech\\.edu\\.sg\\/d2l\\/le\\/lessons\\/(\\d+)/)[1];if(e.match(/https:\\/\\/xsite\\.singaporetech\\.edu\\.sg\\/d2l\\/home\\/(\\d+)/))return e.match(/https:\\/\\/xsite\\.singaporetech\\.edu\\.sg\\/d2l\\/home\\/(\\d+)/)[1];if(e.match(/https:\\/\\/xsite\\.singaporetech\\.edu\\.sg\\/content\\/enforced\\/(\\d+)/))return e.match(/https:\\/\\/xsite\\.singaporetech\\.edu\\.sg\\/content\\/enforced\\/(\\d+)/)[1];return null}const t=e();if(!t)return void alert('Cannot detect course ID from this page.\\n\\nPlease make sure you are on a xSiTe course page (e.g., course home, or content page).');const n=\`https://xsite.singaporetech.edu.sg/d2l/lms/quizzing/admin/quizzes_manage.d2l?ou=\${t}\`,o=window.open(n,'_blank');o?setTimeout(()=>{try{o.eval('(function(){const e=\"/d2l/lms/quizzing/user/quiz_summary.d2l\";function t(e,t={},n=[]){const l=document.createElement(e);for(const e in t)if(\"style\"===e&&\"object\"==typeof t[e])for(const n in t[e])l.style[n]=t[e][n];else l.setAttribute(e,t[e]);const o=e=>{if(\"string\"==typeof e)l.appendChild(document.createTextNode(e));else if(e instanceof Node)l.appendChild(e)};if(Array.isArray(n))n.forEach(o);else o(n);return l}function n(e,t){navigator.clipboard.writeText(e).then(()=>{t.textContent=\"Copied!\",t.style.color=\"green\",setTimeout(()=>{t.textContent=\"\"},1500)}).catch(n=>{console.error(\"Bookmarklet: Failed to copy text: \",n),t.textContent=\"Copy failed!\",t.style.color=\"red\",setTimeout(()=>{t.textContent=\"\"},2e3)})}const l=document.querySelectorAll(\\'a[title=\"Edit Quiz\"]\\'),o=[],i=window.location.hostname;console.log(\"Bookmarklet: Found \"+l.length+\" potential quiz links.\");l.forEach(e=>{try{const t=new URL(e.href,window.location.origin),n=t.searchParams.get(\"qi\"),l=t.searchParams.get(\"ou\"),i=e.textContent.trim();n&&l&&i&&o.push({name:i,qi:n,ou:l})}catch(e){console.error(\"Bookmarklet: Error parsing anchor:\",e)}});const c=\"d2l-quiz-extractor-overlay\",r=document.getElementById(c);r&&r.remove();const d=t(\"div\",{id:c,style:{position:\"fixed\",top:\"0\",left:\"0\",width:\"100%\",height:\"100%\",backgroundColor:\"rgba(0, 0, 0, 0.6)\",zIndex:\"10000\",display:\"flex\",alignItems:\"center\",justifyContent:\"center\",padding:\"20px\"}},),s=t(\"div\",{style:{backgroundColor:\"#fff\",padding:\"25px\",borderRadius:\"8px\",maxWidth:\"700px\",width:\"90%\",maxHeight:\"80vh\",overflowY:\"auto\",boxShadow:\"0 5px 15px rgba(0,0,0,0.3)\",fontFamily:\"Arial, sans-serif\"}},),a=t(\"h2\",{style:{marginTop:\"0\",marginBottom:\"15px\",borderBottom:\"1px solid #eee\",paddingBottom:\"10px\",color:\"#333\"}},\"D2L Student Quiz URLs\"),p=t(\"button\",{style:{position:\"absolute\",top:\"10px\",right:\"15px\",background:\"none\",border:\"none\",fontSize:\"24px\",fontWeight:\"bold\",cursor:\"pointer\",color:\"#888\"}},\"×\");p.onclick=()=>d.remove();s.appendChild(p);s.appendChild(a);if(o.length>0){o.sort((e,t)=>e.name.localeCompare(t.name));const l=t(\"ul\",{style:{listStyle:\"none\",padding:\"0\",margin:\"0\"}});o.forEach(o=>{const c=\"https://\"+i+e+\"?qi=\"+o.qi+\"&ou=\"+o.ou,r=t(\"li\",{style:{marginBottom:\"15px\",paddingBottom:\"15px\",borderBottom:\"1px solid #eee\",display:\"flex\",alignItems:\"center\",flexWrap:\"wrap\"}}),d=t(\"span\",{style:{flexGrow:\"1\",marginRight:\"10px\",fontWeight:\"bold\",color:\"#444\"}},o.name),a=t(\"input\",{type:\"text\",value:c,readOnly:!0,style:{flexBasis:\"100%\",marginTop:\"5px\",padding:\"5px 8px\",border:\"1px solid #ccc\",borderRadius:\"4px\",fontSize:\"0.9em\",color:\"#555\",backgroundColor:\"#f9f9f9\",width:\"calc(100% - 16px)\"}});a.onclick=()=>a.select();const p=t(\"button\",{style:{marginLeft:\"10px\",padding:\"5px 10px\",fontSize:\"0.9em\",cursor:\"pointer\",backgroundColor:\"#007bff\",color:\"white\",border:\"none\",borderRadius:\"4px\"}},\"Copy\"),u=t(\"span\",{style:{marginLeft:\"8px\",fontSize:\"0.85em\",fontStyle:\"italic\"}});p.onclick=()=>n(c,u);r.appendChild(d);r.appendChild(p);r.appendChild(u);r.appendChild(a);l.appendChild(r)});s.appendChild(l)}else{const e=t(\"p\",{style:{color:\"#777\",fontStyle:\"italic\"}},\\'No quiz links found on this page matching the expected pattern (links with title=\"Edit Quiz\"). Make sure you are on the main Quizzes page in your xSiTe course.\\');s.appendChild(e)}d.appendChild(s);document.body.appendChild(d);d.addEventListener(\"click\",function(e){e.target===d&&d.remove()})})();')}catch(e){console.log('Bookmarklet will run once page loads')}},2e3):alert('Failed to open new tab. Please allow pop-ups for this site.')})();`;

        function createBookmarklet() {
            const container = document.getElementById('bookmarkletContainer');
            const link = document.createElement('a');
            link.href = bookmarkletCode;
            link.className = 'bookmarklet-button';
            link.textContent = 'Get Quiz Links';
            link.title = 'Drag to bookmarks bar';
            container.appendChild(link);
        }

        function copyBookmarkletCode() {
            navigator.clipboard.writeText(bookmarkletCode).then(() => {
                const status = document.getElementById('copyStatus');
                status.style.display = 'inline-block';
                status.textContent = '✓ Code copied to clipboard';
                setTimeout(() => {
                    status.style.display = 'none';
                }, 4000);
            }).catch(err => {
                alert('Failed to copy. Please try again.');
            });
        }

        createBookmarklet();
    </script>
</body>
</html>